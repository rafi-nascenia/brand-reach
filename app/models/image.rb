class Image < ActiveRecord::Base
  # ----------------------------------------------------------------------
  # == Include Modules == #
  # ----------------------------------------------------------------------

  # ----------------------------------------------------------------------
  # == Constants == #
  # ----------------------------------------------------------------------
  # max image size in MB
    MAX_IMAGE_SIZE = 3

  # ----------------------------------------------------------------------
  # == Attributes == #
  # ----------------------------------------------------------------------

  attr_accessor :crop_x, :crop_y, :crop_w, :crop_h

  # ----------------------------------------------------------------------
  # == File Uploader == #
  # ----------------------------------------------------------------------

  mount_uploader :image_path, ImageUploader

  # ----------------------------------------------------------------------
  # == Associations and Nested Attributes == #
  # ----------------------------------------------------------------------

  belongs_to :message

  # ----------------------------------------------------------------------
  # == Validations == #
  # ----------------------------------------------------------------------

  validates :image_path, presence: true
  validate :file_size

  # ----------------------------------------------------------------------
  # == Callbacks == #
  # ----------------------------------------------------------------------

  # ----------------------------------------------------------------------
  # == Scopes and Other macros == #
  # ----------------------------------------------------------------------

  # ----------------------------------------------------------------------
  # == Instance methods == #
  # ----------------------------------------------------------------------

  # ----------------------------------------------------------------------
  # == Class methods == #
  # ----------------------------------------------------------------------

  private

  def file_size
    if image_path.file.size.to_f/(1000*1000) > MAX_IMAGE_SIZE.to_f
      errors.add(:big_image, "You cannot upload a Image greater than #{MAX_IMAGE_SIZE.to_f}MB.")
    end
  end
end
