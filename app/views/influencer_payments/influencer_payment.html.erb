<%= stylesheet_link_tag 'payments', media: 'all' %>

<% title "Influencer Payment" %>

<div class="bank-accounts">

  <div class="influencer-payment-div ">
    <p class="payment-balance">Available<span class="space"></span>Balance:<span class="balance">$2500</span><span class="space"></span>INR</p>
    <div class="amount-withdraw">
      <%= label_tag 'withdraw_amount', 'Amount to Withdraw' %>
      <%= text_field_tag 'withdraw_amount', '' %>
      <%= link_to 'WITHDRAW', '', :class => 'btn btn-withdraw', id: 'withdraw_amount' %>
    </div>
  </div>

  <table class="table table-striped table-bordered table-responsive payments_table bank_accounts_table">
    <thead>
    <tr class="payment-header">
      <th>Account Name</th>
      <th>Account Number</th>
      <th>Bank</th>
      <th>Country</th>
      <th>Currency</th>
      <th>Action</th>
    </tr>
    </thead>

    <% if @bank_accounts.present? %>
        <tbody>
        <% @bank_accounts.each do |bank_account| %>
            <tr id="<%= bank_account.id %>">
              <td><input type="radio" name="bank_account" id="bank_account_<%= bank_account.id %>" value="1">&nbsp;&nbsp;<%= bank_account.account_name %></td>
              <td><%= bank_account.account_number %></td>
              <td><%= bank_account.bank_name %></td>
              <td><%= Carmen::Country.coded(bank_account.country) %></td>
              <td><%= bank_account.currency %></td>
              <td><%= link_to image_tag('trash-icon.png'), bank_account_path(bank_account.id), method: :delete, data: { confirm: 'Are you sure to delete Bank Account ?' } %></td>
            </tr>
        <% end %>
        </tbody>
    <% end %>
  </table>

  <a class="add-bank-account" data-toggle="modal" data-target="#AddBankAccount"><i class="fa fa-plus"></i>&nbsp; Add Bank Account</a>

</div>

<div class="payment-content">

  <div class="tab-content">
    <div class="panel-payment">
      <div id="payment" class="tab-pane fade in active">
        <%= image_tag('Transactions.png', :class => 'transaction-table') %> &nbsp; Transactions
        <%= link_to 'DOWNLOAD INVOICE', '', :class => 'btn btn-influencer-download pull-right', id: 'export_payments' %>

        <table class="table table-striped table-bordered table-responsive payments_table">
          <thead>
          <tr class="payment-header">
            <th class="squaredFour" id="selecctall"><input type="checkbox" class="payment-header" value="all"/></th>
            <th>Date Billed</th>
            <th>Transaction ID</th>
            <th>Amount Recieved (INR)</th>
            <th>Payment Status</th>
          </tr>
          </thead>

          <% if @transactions.present? %>
              <tbody>
              <% @transactions.each do |transaction| %>
                  <tr>
                    <td class="squaredFour"><input type="checkbox" data-id="<%= transaction.id %>" value="1"/></td>
                    <td><%= transaction.billed_date.present? ? transaction.billed_date.strftime("%B %d, %Y") : 'NA' %></td>
                    <td><%= sprintf("BP%05d" ,transaction.id) %></td>
                    <td><%= transaction.amount_billed %></td>
                    <td>
                      <% if transaction.pending? %>
                          <span class="status-circle status-pending"></span>Pending
                      <% elsif transaction.paid? %>
                          <span class="status-circle status-paid"></span>Paid
                      <% else %>
                          <span class="status-circle status-failed"></span>Failed
                      <% end %>
                    </td>
                  </tr>
              <% end %>
              </tbody>
          <% end %>

        </table>
      </div>
    </div>
  </div>

</div>

<div class="modal fade" id="AddBankAccount" role="dialog">
  <div class="modal-dialog withdraw-modal-dialog">

    <div class="modal-content">

      <div class="modal-header withdraw-modal-header">
        <a href="#"><%= image_tag('logo_white.png', :class => 'img-responsive withdraw-modal-logo') %></a>
        <button type="button" class="close withdraw-modal-close" data-dismiss="modal">&times; </button>
      </div>

      <div class="modal-body withdraw-modal-body">

        <%= form_for BankAccount.new, url: bank_accounts_path, html: { class: 'form-horizontal bank-account-modal'} do |f| %>

            <div class="row">
              <div class="col-md-4 bank_location">Bank and Location</div>
            </div>

            <div class="col-md-4">
              <%= f.label :bank_name, "Bank Name" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :bank_name %>
            </div>

            <div class="col-md-4">
              <%= f.label :address, "Address" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :address %>
            </div>

            <div class="col-md-4">
              <%= f.label :city, "City" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :city %>
            </div>

            <div class="col-md-4">
              <%= f.label :zip, "ZIP/Postal Code" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :zip %>
            </div>

            <div class="col-md-4">
              <%= f.label :country, "Country" %>
            </div>
            <div class="col-md-8">
              <%= f.country_select :country, {priority: %w(US CA IN)}, { :class => 'bank-account-country'}, {} %>
            </div>

            <div class="col-md-4">
              <%= f.label :state, "State/Region" %>
            </div>
            <div class="col-md-8">
              <%#= render partial: 'shared/sub_region_select', locals: {parent_region: f.object.country } %>
              <%= f.text_field :state %>
            </div>

            <div class="row">
              <div class="col-md-4 bank_location">Account Details</div>
            </div>

            <div class="col-md-4">
              <%= f.label :account_name, "Account Name" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :account_name %>
            </div>

            <div class="col-md-4">
              <%= f.label :account_number, "Account Number" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :account_number %>
            </div>

            <div class="col-md-4">
              <%= f.label :currency, "Currency" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :currency %>
            </div>

            <div class="col-md-4">
              <%= f.label :routing_number, "Routing Number" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :routing_number %>
            </div>

            <div class="col-md-4">
              <%= f.label :bic, "BIC(Swift Code)" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :bic %>
            </div>

            <div class="col-md-4">
              <%= f.label :iban, "IBAN" %>
            </div>
            <div class="col-md-8">
              <%= f.text_field :iban %>
            </div>

            <div class="row">
              <div class="col-md-4">
                <%= f.button  'SAVE', class: 'btn btn-withdraw pull-right' %>
              </div>
              <div class="col-md-8">
                <%= link_to 'CANCEL', '', class: 'btn btn-withdraw btn-close' %>
              </div>

            </div>

        <% end %>
      </div>
    </div>
  </div>
</div>

</div>

</div>

<script type="text/javascript">
    $(document).ready(function(){

        $('#export_payments').click(function() {
            var payment_ids = [];
            $('.squaredFour input:checked').each(function() {
                payment_ids.push($(this).data('id'));
            });

            $.ajax({
                url: "<%= export_payments_brand_payments_path %>",
                type: 'post',
                dataType: 'script',
                data: {
                    payment_ids: payment_ids
                }
            });

        });

        $('.bank_accounts_table tr').click(function() {
            $(this).find('td input:radio').prop('checked', true);
        });


    });
</script>