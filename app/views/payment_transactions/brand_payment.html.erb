<%= stylesheet_link_tag 'payments', media: 'all' %>

<% title "Brand Payment" %>

<div class="payment-div ">
  <div class="payment-button-set">
    <%= link_to 'DOWNLOAD INVOICE', '', :class => 'btn btn-download', id: 'export_payments' %>
    <button class="btn btn-withdraw" data-toggle="modal" data-target="#withdrawModal">WITHDRAW</button>
  </div>
  <div class="nav payment-balance pull-right">Available<span class="space"></span>Balance:<span class="balance">$2500</span><span class="space"></span>USD</div>
</div>

<div class="payment-content">

  <ul class="nav nav-tabs" id="transaction-tabs">
    <li class= "active">
      <a href="#payment">
        <%= image_tag('Transactions.png', :class => 'transaction-table') %> &nbsp; Transactions
      </a>
    </li>
  </ul>
  <div class="tab-content">
    <div class="panel panel-payment">
      <div id="payment" class="tab-pane fade in active">

        <table class="table table-striped table-bordered table-responsive payments_table">
          <thead>
          <tr class="payment-header">
            <th class="squaredFour" id="selecctall"><input type="checkbox" class="payment-header" value="all"/></th>
            <th>Date Billed</th>
            <th>Transaction ID</th>
            <th>Amount Recieved (USD)</th>
            <th>Payment Status</th>
          </tr>
          </thead>

          <% if @transactions.present? %>

              <tbody>
              <% @transactions.each do |transaction| %>
                  <tr>
                    <td class="squaredFour"><input type="checkbox" data-id="<%= transaction.id %>" value="1"/></td>
                    <td><%= transaction.billed_date.present? ? transaction.billed_date.strftime("%B %d, %Y") : 'NA' %></td>
                    <td><%= sprintf("BP%05d" ,transaction.id) %></td>
                    <td><%= transaction.amount_billed %></td>
                    <td>
                      <% if transaction.pending? %>
                          <span class="status-circle status-pending"></span>Pending
                      <% elsif transaction.paid? %>
                          <span class="status-circle status-paid"></span>Paid
                      <% else %>
                          <span class="status-circle status-failed"></span>Failed
                      <% end %>
                    </td>
                  </tr>
              <% end %>
              </tbody>
          <% end %>

        </table>
      </div>
    </div>
  </div>

</div>

<!-- Withdraw Modal -->
<div class="modal fade" id="withdrawModal" role="dialog">
  <div class="modal-dialog withdraw-modal-dialog">

    <!-- Modal content-->
    <div class="modal-content withdraw-modal-content">
      <div class="modal-header withdraw-modal-header">
        <a href="#"><%= image_tag('logo_white.png', :class => 'img-responsive withdraw-modal-logo') %></a>
        <button type="button" class="close withdraw-modal-close" data-dismiss="modal">&times; </button>
      </div>
      <div class="modal-body withdraw-modal-body">
        <p>The money will be in your bank account in 3-4 business days, depending on your bank.</p>

        <div class="without-first-line">
          <div class="row from-balance">
            <div class="col-md-3 col-xs-5">
              <p class="pull-right">From this balance</p>
            </div>
            <div class="col-md-9 col-xs-7 padding-zero">
              <span class="balance">$ 2500</span> USD</span>
            </div>
          </div>


          <div class="row withdraw-modal-amount">
            <label for="amount" class="modal-amount col-md-3 col-xs-5">
              <p class="pull-right">Amount</p>
            </label>
            <span class="col-md-9 col-xs-7 padding-zero"><input type="text" class="modal-amount-input" id="amount">&nbsp;&nbsp;USD</span>
          </div>


          <div class="row withdraw-modal-bank">
            <div class="col-md-3 col-xs-5">
              <p class="pull-right">To</p>
            </div>
            <div class="col-md-9 col-xs-7 padding-zero">
              <button class="dropdown-toggle bank-name" type="button" data-toggle="dropdown">J.P. MORGAN CHASE BANK, N.A.Checking x - 4536
                <i class="fa fa-sort"></i>
              </button>
              <ul class="dropdown-menu bank-dropdown">
                <li><a href="#">J.P. MORGAN CHASE BANK, N.A.Checking x - 4537</a></li>
                <li><a href="#">J.P. MORGAN CHASE BANK, N.A.Checking x - 4538</a></li>
              </ul>
            </div>
          </div>

          <div class="row add-account">
            <div class="col-md-3 col-xs-5">
            </div>
            <div class="col-md-9 col-xs-7 add-bank padding-zero">
              <a href="#">Add Bank Account</a>
            </div>
          </div>


          <div class="row">
            <div class="col-lg-3 col-md-3 col-sm-5 col-xs-2">
            </div>
            <div class="col-lg-9 col-md-9 col-sm-7 col-xs-10 padding-zero">
              <button type="button" class="btn withdraw-modal-continue col-lg-3 col-md-4 col-sm-4 col-xs-5" data-dismiss="modal">CONTINUE</button>
              <button type="button" class="btn withdraw-modal-cancel col-lg-3 col-md-4 col-sm-4 col-xs-5" data-dismiss="modal">CANCEL</button>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>

</div>

</div>

<script type="text/javascript">
    $(document).ready(function(){

        $('#export_payments').click(function() {
            var payment_ids = [];
            $('.squaredFour input:checked').each(function() {
                payment_ids.push($(this).data('id'));
            });

            $.ajax({
                url: "<%= export_payments_payment_transactions_path %>",
                type: 'post',
                dataType: 'script',
                data: {
                    payment_ids: payment_ids
                }
            });


        });


    });
</script>