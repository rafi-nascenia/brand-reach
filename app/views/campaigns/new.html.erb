<%= stylesheet_link_tag  'campaigns', media: 'all' %>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

<% title 'Brand Campaign' %>

<div class="campaign-create-wrapper">

  <div>
    <%= image_tag(@influencer.profile_picture, :class => 'campaign-influencer-picture', :alt => 'profile-picture') %>
    <div class="influencer-description">
      <h4><%= @influencer.full_name.present? ? @influencer.full_name : 'USER' %></h4>
      <p class="influencer-title"> <%= @influencer.industry.present? ? @influencer.industry : 'Entrepreneur' %> </p>
      <p class="influencer-address"> <%= @influencer.street_address.present? ? @influencer.street_address : 'User Address'  %> </p>
    </div>
  </div>

  <div>
    <p class="influencer-profile-info">
      <%= @influencer.short_bio %>
    </p>
  </div>

  <%= form_for @campaign, url: campaigns_path, html: { class: 'form-horizontal'}, data: { parsley_validate: '' } do |f| %>

      <%= render 'shared/show_errors', :object => @campaign %>

      <%= csrf_meta_tag %>

      <div class="col-md-12">
        <div class="social-account-tabs">
          <ul class="nav nav-tabs social-account-nav-tabs">
          </ul>

          <div class="tab-content social-account-tab-content">
            <div id="fb_bhanu" class="tab-pane fade in active">

              <div id="costs" data-costs="<%= @costs %>"></div>

              <div class="form-group">
                <%= f.label :facebook_account_id, 'Choose Social Account Name', class: 'control-label' %>
                <div class="display-inline">
                  <%= f.select :facebook_account_id, options_for_select(@influencer.active_facebook_accounts.map{ |account| [account.name, account.id] }, @campaign.facebook_account_id), {}, { :class => 'form-control type-of-post', :id => 'social_account' } %>
                </div>
              </div>

              <div class="form-group">
                <%= f.label :post_type, 'Choose the type of post', class: 'control-label' %>
                <div class="display-inline">
                  <%= f.select :post_type, options_for_select(Campaign.post_types.map{ |type, value| [type.titleize, value] }, Campaign.post_types[@campaign.post_type]), {}, { :class => 'form-control type-of-post', :id => 'post_type' } %>
                </div>
              </div>

              <div class="form-group">
                <%= f.label :cost, 'Cost ( INR )', class: 'control-label' %>
                <div class="display-inline">
                  <%= f.text_field :cost, { class: 'form-control campaign-cost-input', value: @campaign.cost.present? ? @campaign.cost : @costs[0][0], readonly: true, 'data-parsley-excluded' => 'input[type=text]', id: 'post_cost' } %>
                </div>
              </div>

              <div class="form-group">
                <%= f.label '', 'Schedule Post', class: 'control-label' %>
                <div class="display-inline">
                  <div class="display-inline">
                    <%= f.radio_button :schedule_type, 'daily', { :checked => true, class: 'daily' } %>
                    <span>Run my ad set continuously starting today</span>
                  </div>

                  <div class="display-inline">
                    <%= f.radio_button :schedule_type, 'date_range', class: 'date-range' %>
                    <span>Set a start and end date</span>
                  </div>

                  <div class="campaign-date" id="start_end">
                    <div>
                      <%= f.label :start_date, 'Start' %>
                      <%= f.text_field :start_date, { value: Time.now.strftime('%d/%m/%Y'), class: 'start_date', disabled: 'disabled' } %>
                    </div>

                    <div>
                      <%= f.label :end_date, 'End' %>
                      <%= f.text_field :end_date, { value: (Time.now + 1.month).strftime('%d/%m/%Y'), class: 'end_date', disabled: 'disabled'} %>
                    </div>
                  </div>

                </div>
              </div>

              <div class="form-group">
                <%= f.label :name, 'Enter Campaign Name', class: 'control-label' %>
                <div class="display-inline campaign-name-input">
                  <%= f.text_field :name, 'data-parsley-required' => 'true' %>
                </div>
              </div>

              <%= f.hidden_field :sender_id %>
              <%= f.hidden_field :receiver_id %>
            </div>
          </div>
        </div>
      </div>

      <div class="text-pink">WHAT TEXT AND LINKS DO YOU WANT TO USE?</div>

      <div class="text-headline-form">

        <div class="">
          <%= f.label :text, 'Text' %>
        </div>
        <div class="">
          <%= f.text_area :text, rows: 4, 'data-parsley-required' => 'true' %>
        </div>

        <div class="">
          <%= f.label :headline, 'Headline' %>
        </div>
        <div class="">
          <%= f.text_field :headline, 'data-parsley-required' => 'true' %>
        </div>

      </div>
      <div class="new-campaign-button-set">
        <%= f.button 'BOOK NOW', class: 'btn btn-book-now' %>
        <%= link_to 'CANCEL', explores_path, class: 'btn btn-book-now grey-color' %>
      </div>
  <% end %>
</div>

</div>

<script type="text/javascript">
    $(document).ready(function() {

        $('.start_date').datepicker({
            dateFormat: "dd/mm/yy",
            onSelect: function(dateText, inst) {
                $(this).attr('value',dateText);
            }
        });

        $('.end_date').datepicker({
            dateFormat: "dd/mm/yy",
            onSelect: function(dateText, inst) {
                $(this).attr('value',dateText);
            }
        });

        if($('.daily:checked').length)
        {
            $('#start_end').find('*').attr('disabled', true);
        }
        else
        {
            $('#start_end').find('*').attr('disabled', false);
        }

        $('.daily').click(function() {
            $('#start_end').find('*').attr('disabled', true);
        });

        $('.date-range').click(function() {
            $('#start_end').find('*').attr('disabled', false);
        });

        var social_account_index = $('#social_account').find('option:selected').index();
        var costs = <%= @costs %>;

        if (costs.length) {
            // Dont change value 0..3 here, they are post types of campaign. if need any change then synchronize with enum in Campaign model
            if (this.value == 0) {
                $('#post_cost').val(costs[social_account_index][0]);
            }
            else if (this.value == 1) {
                $('#post_cost').val( costs[social_account_index][1] );
            }
            else if (this.value == 2) {
                $('#post_cost').val(costs[social_account_index][2]);
            }
            else if (this.value == 3) {
                $('#post_cost').val(costs[social_account_index][3]);
            }
        }

        $('#social_account').change(function() {
            social_account_index = $('#social_account').find('option:selected').index();
            $('#post_type option:first').prop('selected', 'selected');
            $('#post_cost').val(costs[social_account_index][0]);
        });

        $('#post_type').change(function() {
            if (costs.length) {
                // Dont change value 0..3 here, they are post types of campaign. if need any change then synchronize with enum in Campaign model
                if (this.value == 0) {
                    $('#post_cost').val(costs[social_account_index][0]);
                }
                else if (this.value == 1) {
                    $('#post_cost').val( costs[social_account_index][1] );
                }
                else if (this.value == 2) {
                    $('#post_cost').val(costs[social_account_index][2]);
                }
                else if (this.value == 3) {
                    $('#post_cost').val(costs[social_account_index][3]);
                }
            }

        });
    })
</script>
